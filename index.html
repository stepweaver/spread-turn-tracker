<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track orthodontic expander turns for your child">
    <title>Expander Turn Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container" id="mainContainer" style="display: none;">
        <!-- Header with editable child name -->
        <header>
            <h1 id="childName" contenteditable="true">Child</h1>
            <button id="settingsBtn" class="icon-btn" aria-label="Settings">⚙️</button>
        </header>

        <!-- Progress Cards -->
        <div class="progress-section">
            <div class="progress-card">
                <h2>Top</h2>
                <div class="counter">
                    <span id="topDone">0</span> / <span id="topTotal">27</span>
                </div>
                <div class="remaining">
                    <span id="topRemaining">27</span> remaining
                    <span class="progress-percentage" id="topPercentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div id="topProgress" class="progress-fill"></div>
                </div>
            </div>

            <div class="progress-card">
                <h2>Bottom</h2>
                <div class="counter">
                    <span id="bottomDone">0</span> / <span id="bottomTotal">23</span>
                </div>
                <div class="remaining">
                    <span id="bottomRemaining">23</span> remaining
                    <span class="progress-percentage" id="bottomPercentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div id="bottomProgress" class="progress-fill"></div>
                </div>
            </div>
        </div>

        <!-- Status Strip -->
        <div class="status-strip">
            <div class="status-item">
                <span class="status-label">Last logged:</span>
                <span id="lastLoggedDate">Never</span>
            </div>
            <div class="status-item status-item-next-due">
                <div>
                    <span class="status-label">Next due:</span>
                    <span id="nextDueDate">-</span>
                </div>
                <span id="nextDueScheduleHint" class="status-hint" aria-hidden="true"></span>
            </div>
            <div class="status-item">
                <span class="status-label">Status:</span>
                <span id="statusIndicator" class="status-badge">Ready</span>
            </div>
        </div>

        <!-- Warning Message -->
        <div id="warningMessage" class="warning hidden"></div>

        <!-- Action Buttons -->
        <div class="actions">
            <div id="logButtons">
                <button id="logTurnBtn" class="btn btn-primary">Log Today's Turn</button>
            </div>
            <div class="secondary-actions">
                <button id="undoBtn" class="btn btn-secondary">Undo last log</button>
                <button id="resetBtn" class="btn btn-secondary">Reset</button>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel hidden">
            <div class="settings-header">
                <h2>Settings</h2>
                <button id="closeSettingsBtn" class="icon-btn" aria-label="Close settings">✕</button>
            </div>
            <div class="settings-content">
                <div class="setting-group">
                    <label for="settingsChildName">Child Name</label>
                    <input type="text" id="settingsChildName" placeholder="Child">
                </div>
                <div class="setting-group">
                    <label for="settingsInstallDate">Install Date</label>
                    <input type="date" id="settingsInstallDate">
                </div>
                <div class="setting-group">
                    <label>Schedule Type</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="scheduleType" value="every_n_days" checked>
                            <span>Every N Days</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="scheduleType" value="twice_per_week">
                            <span>Twice Per Week</span>
                        </label>
                    </div>
                </div>
                <div class="setting-group">
                    <label for="settingsIntervalDays">Interval (days)</label>
                    <input type="number" id="settingsIntervalDays" min="1" value="2">
                </div>
                <div class="setting-group">
                    <label for="settingsTopTotal">Top Total</label>
                    <input type="number" id="settingsTopTotal" min="1" value="27">
                </div>
                <div class="setting-group">
                    <label for="settingsBottomTotal">Bottom Total</label>
                    <input type="number" id="settingsBottomTotal" min="1" value="23">
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div class="history-section">
            <h2>Recent History</h2>
            <div id="historyList" class="history-list">
                <p class="empty-state">No turns logged yet.</p>
            </div>
        </div>

        <!-- Treatment Notes Section -->
        <div class="treatment-notes-section">
            <div class="section-header">
                <h2>Treatment Notes</h2>
                <button id="addTreatmentNoteBtn" class="btn btn-secondary btn-small">+ Add Note</button>
            </div>
            <div id="treatmentNotesList" class="treatment-notes-list">
                <p class="empty-state">No treatment notes yet.</p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="app-footer">
            <a href="https://stepweaver.dev" target="_blank" rel="noopener noreferrer">λstepweaver LLC</a>
        </footer>
    </div>

    <!-- Reset Confirmation Modal -->
    <div id="resetModal" class="modal hidden">
        <div class="modal-content">
            <h2>Reset All Turns?</h2>
            <p>This will delete all turn history. Settings will be preserved. This cannot be undone.</p>
            <div class="modal-actions">
                <button id="confirmResetBtn" class="btn btn-danger">Reset</button>
                <button id="cancelResetBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Note Input Modal -->
    <div id="noteModal" class="modal hidden">
        <div class="modal-content">
            <h2>Add Note (Optional)</h2>
            <textarea id="noteInput" placeholder="Add a note about this turn..." rows="3"></textarea>
            <div class="modal-actions">
                <button id="confirmNoteBtn" class="btn btn-primary">Log Turn</button>
                <button id="cancelNoteBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Treatment Note Modal -->
    <div id="treatmentNoteModal" class="modal hidden">
        <div class="modal-content">
            <h2 id="treatmentNoteModalTitle">Add Treatment Note</h2>
            <div class="setting-group">
                <label for="treatmentNoteDateInput">Date</label>
                <input type="date" id="treatmentNoteDateInput">
            </div>
            <div class="setting-group">
                <label for="treatmentNoteTextInput">Note</label>
                <textarea id="treatmentNoteTextInput" placeholder="Enter treatment note, visit details, or call notes..." rows="4"></textarea>
            </div>
            <div class="modal-actions">
                <button id="saveTreatmentNoteBtn" class="btn btn-primary">Save</button>
                <button id="cancelTreatmentNoteBtn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal hidden">
        <div class="modal-content">
            <h2>Login</h2>
            <p id="loginError" class="error-message hidden"></p>
            <div class="setting-group">
                <label for="loginUsername">Username</label>
                <input type="text" id="loginUsername" placeholder="Enter username" autocomplete="username">
            </div>
            <div class="setting-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Enter password" autocomplete="current-password">
            </div>
            <div class="modal-actions">
                <button id="loginBtn" class="btn btn-primary">Login</button>
            </div>
            <p class="loading-message hidden" id="loginLoading">Logging in...</p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
